@page "/Programs"
@using spaceTracker.Models
@using spaceTracker.Services


<PageTitle>Space Programs Timeline</PageTitle>

<div class="timeline-container">
    <div class="timeline-header">
        <h1>Space Programs Timeline</h1>
        <p class="subtitle">Exploring humanity's journey to the stars</p>
    </div>

    @if (isLoading && programs.Count == 0)
    {
        <div class="loading-initial">
            <div class="spinner"></div>
            <p>Loading space programs...</p>
        </div>
    }

    @{
        int? lastYear = null;
    }

    <div class="timeline">
        @foreach (var program in programs)
        {
            var year = program.StartDate?.Year;
            if (year != lastYear)
            {
                <div class="year-divider">@year</div>
                lastYear = year;
            }

            <div class="timeline-item @(program.EndDate == null ? "active" : "completed")">
                <div class="timeline-marker"><div class="marker-dot"></div></div>
                <div class="timeline-content">
                    @if (program.Image?.ImageUrl != null)
                    {
                        <div class="program-image">
                            <img src="@program.Image.ImageUrl" alt="@program.Name" />
                        </div>
                    }

                    <div class="program-header">
                        <h2>@program.Name</h2>
                        @if (program.EndDate == null)
                        {
                            <span class="status-badge active-badge">Active</span>
                        }
                        else
                        {
                            <span class="status-badge completed-badge">Completed</span>
                        }
                    </div>

                    <div class="program-dates">
                        <span><strong>Started:</strong> @(program.StartDate?.ToString("MMMM dd, yyyy") ?? "Unknown")</span>
                        @if (program.EndDate != null)
                        {
                            <span><strong>Ended:</strong> @program.EndDate.Value.ToString("MMMM dd, yyyy")</span>
                        }
                    </div>

                    <p class="program-description">@program.Description</p>

                    @if (program.Agencies?.Any() == true)
                    {
                        <div class="agencies">
                            <strong>Agencies:</strong>
                            @foreach (var agency in program.Agencies)
                            {
                                <span class="agency-badge">@agency.Name</span>
                            }
                        </div>
                    }
                </div>
            </div>
        }
    </div>

    @if (!isLoading && errorMessage == null)
    {
        <button class="load-more" @onclick="LoadNextBatchAsync">Load More</button>
    }

    @if (isLoading && programs.Count > 0)
    {
        <div class="loading-more">
            <div class="spinner-small"></div>
            <p>Loading more programs...</p>
        </div>
    }

    @if (errorMessage != null)
    {
        <div class="error-message">
            <p>⚠️ @errorMessage</p>
        </div>
    }
</div>
