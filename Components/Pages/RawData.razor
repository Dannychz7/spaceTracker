@* This page provides a direct view of all backend API responses by displaying their raw JSON output. It's 
designed for debugging, validation, and transparency, allowing you to inspect exactly what each service returns before it's 
processed elsewhere in the app. Each section loads independently and shows real-time data from weather, launch, satellite, 
and ISS tracking endpoints. *@

@page "/rawdata"
@using spaceTracker.Models
@using spaceTracker.Services
@using System.Text.Json
@inject weatherService weatherService
@inject RocketLaunchLiveService rocketLaunchService
@inject n2yoService n2yoService

<PageTitle>Raw API Data - Pure JSON</PageTitle>

<h1>Raw API Data Display</h1>
<p>JSON responses from backend services</p>

<hr />

<!-- Weather API Section -->
<h2>Weather API (Boston, MA)</h2>
<p><strong>Service:</strong> weatherService.GetWeatherData()</p>
<p><strong>Status:</strong> @(weatherData != null ? "> Loaded" : "Loading...")</p>

@if (weatherData != null)
{
    <pre style="background: #f4f4f4; padding: 10px; overflow-x: auto;">@SerializeToJson(weatherData)</pre>
}

<hr />

<!-- Rocket Launch API Section -->
<h2>Rocket Launch API</h2>
<p><strong>Service:</strong> RocketLaunchLiveService.GetUpcomingLaunches()</p>
<p><strong>Status:</strong> @(rocketData != null ? $"> Loaded ({rocketData.Count} items)" : "Loading...")</p>

@if (rocketData != null)
{
    <pre style="background: #f4f4f4; padding: 10px; overflow-x: auto;">@SerializeToJson(rocketData)</pre>
}

<hr />

<!-- ISS Position API Section -->
<h2>ISS Position API</h2>
<p><strong>Service:</strong> n2yoService.GetISSPosition()</p>
<p><strong>Parameters:</strong> lat=42.2626, lng=-71.8023, alt=0</p>
<p><strong>Status:</strong> @(issPosition != null ? "> Loaded" : "Loading...")</p>

@if (issPosition != null)
{
    <pre style="background: #f4f4f4; padding: 10px; overflow-x: auto;">@SerializeToJson(issPosition)</pre>
}

<hr />

<!-- Satellites Above Section -->
<h2>Satellites Above Observer</h2>
<p><strong>Service:</strong> n2yoService.GetSatellitesAbove()</p>
<p><strong>Parameters:</strong> lat=42.2626, lng=-71.8023, alt=0, searchRadius=70, categoryId=0</p>
<p><strong>Status:</strong> @(satellitesAbove != null ? $"> Loaded ({satellitesAbove.Above?.Count ?? 0} satellites)" : "Loading...")</p>

@if (satellitesAbove != null)
{
    <pre style="background: #f4f4f4; padding: 10px; overflow-x: auto;">@SerializeToJson(satellitesAbove)</pre>
}

<hr />

<!-- Hubble Position -->
<h2>Hubble Space Telescope Position</h2>
<p><strong>Service:</strong> n2yoService.GetSatellitePosition()</p>
<p><strong>Parameters:</strong> satelliteId=20580, lat=42.2626, lng=-71.8023, alt=0</p>
<p><strong>Status:</strong> @(hubblePosition != null ? "> Loaded" : "Loading...")</p>

@if (hubblePosition != null)
{
    <pre style="background: #f4f4f4; padding: 10px; overflow-x: auto;">@SerializeToJson(hubblePosition)</pre>
}

<hr />

<!-- ISS Visual Passes -->
<h2>ISS Visual Passes</h2>
<p><strong>Service:</strong> n2yoService.GetVisualPasses()</p>
<p><strong>Parameters:</strong> satelliteId=25544, lat=42.2626, lng=-71.8023, alt=0, days=10, minVisibility=300</p>
<p><strong>Status:</strong> @(issVisualPasses != null ? $"> Loaded ({issVisualPasses.Passes?.Count ?? 0} passes)" : "Loading...")</p>

@if (issVisualPasses != null)
{
    <pre style="background: #f4f4f4; padding: 10px; overflow-x: auto;">@SerializeToJson(issVisualPasses)</pre>
}

<hr />

<!-- ISS Radio Passes -->
<h2>ISS Radio Passes</h2>
<p><strong>Service:</strong> n2yoService.GetRadioPasses()</p>
<p><strong>Parameters:</strong> satelliteId=25544, lat=42.2626, lng=-71.8023, alt=0, days=5, minElevation=10</p>
<p><strong>Status:</strong> @(issRadioPasses != null ? $"> Loaded ({issRadioPasses.Passes?.Count ?? 0} passes)" : "Loading...")</p>

@if (issRadioPasses != null)
{
    <pre style="background: #f4f4f4; padding: 10px; overflow-x: auto;">@SerializeToJson(issRadioPasses)</pre>
}

<hr />

<!-- ISS TLE Data -->
<h2>ISS TLE (Two-Line Element) Data</h2>
<p><strong>Service:</strong> n2yoService.GetSatelliteTLE()</p>
<p><strong>Parameters:</strong> satelliteId=25544</p>
<p><strong>Status:</strong> @(issTLE != null ? "> Loaded" : "Loading...")</p>

@if (issTLE != null)
{
    <pre style="background: #f4f4f4; padding: 10px; overflow-x: auto;">@SerializeToJson(issTLE)</pre>
}

<hr />

<h2>Backend Execution Summary</h2>
<pre style="background: #f4f4f4; padding: 10px;">
Total Services Called: 8
Execution Method: Task.WhenAll() - Parallel Async
Location: Worcester, MA (42.2626°N, 71.8023°W)

Services:
  > weatherService
  > RocketLaunchLiveService  
  > n2yoService (6 different endpoints)
</pre>

@code {
    private weatherResponse? weatherData;
    private List<RocketLaunchItem>? rocketData;
    private SatellitePosition? issPosition;
    private SatellitePosition? hubblePosition;
    private SatellitesAboveResponse? satellitesAbove;
    private VisualPassesResponse? issVisualPasses;
    private RadioPassesResponse? issRadioPasses;
    private TleResponse? issTLE;

    // Worcester, MA coordinates
    private const double worcesterLat = 42.2626;
    private const double worcesterLng = -71.8023;
    private const double worcesterAlt = 0;

    protected override async Task OnInitializedAsync()
    {
        // Boston coordinates for weather
        double bostonLat = 42.3601;
        double bostonLng = -71.0589;

        // Execute all API calls in parallel
        var weatherTask = weatherService.GetWeatherData(bostonLat, bostonLng);
        var rocketTask = rocketLaunchService.GetUpcomingLaunches();
        var issTask = n2yoService.GetISSPosition(worcesterLat, worcesterLng, worcesterAlt);
        var hubbleTask = n2yoService.GetSatellitePosition(20580, worcesterLat, worcesterLng, worcesterAlt);
        var satellitesTask = n2yoService.GetSatellitesAbove(worcesterLat, worcesterLng, worcesterAlt, 70, 0);
        var visualPassesTask = n2yoService.GetVisualPasses(25544, worcesterLat, worcesterLng, worcesterAlt, 10, 300);
        var radioPassesTask = n2yoService.GetRadioPasses(25544, worcesterLat, worcesterLng, worcesterAlt, 5, 10);
        var tleTask = n2yoService.GetSatelliteTLE(25544);

        // Wait for all tasks to complete
        await Task.WhenAll(weatherTask, rocketTask, issTask, hubbleTask, satellitesTask, visualPassesTask, radioPassesTask, tleTask);

        // Assign results
        weatherData = await weatherTask;
        rocketData = await rocketTask;
        issPosition = await issTask;
        hubblePosition = await hubbleTask;
        satellitesAbove = await satellitesTask;
        issVisualPasses = await visualPassesTask;
        issRadioPasses = await radioPassesTask;
        issTLE = await tleTask;
    }

    private string SerializeToJson(object obj)
    {
        var options = new JsonSerializerOptions
        {
            WriteIndented = true,
            PropertyNamingPolicy = JsonNamingPolicy.CamelCase
        };
        return JsonSerializer.Serialize(obj, options);
    }
}